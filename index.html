<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parking Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .plaza {
            width: 100px;
            height: 100px;
            margin: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .plaza.libre {
            background-color: #28a745;
            color: white;
        }
        .plaza.ocupada {
            background-color: #dc3545;
            color: white;
        }
        .barrera {
            width: 150px;
            height: 40px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .barrera.abierta {
            background-color: #28a745;
        }
        .barrera.cerrada {
            background-color: #dc3545;
        }
        .lcd-display {
            background-color: #20c997;
            color: black;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Pantalla LCD</h5>
                        <div class="lcd-display">
                            <div id="lcd-line1">Bienvenido!</div>
                            <div id="lcd-line2">Plazas: 6/6</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Estado de las Barreras</h5>
                        <div class="d-flex justify-content-around">
                            <div>
                                <h6>Entrada</h6>
                                <button id="barrera-entrada" class="btn barrera cerrada">Cerrada</button>
                            </div>
                            <div>
                                <h6>Salida</h6>
                                <button id="barrera-salida" class="btn barrera cerrada">Cerrada</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Estado de las Plazas</h5>
                        <div class="d-flex flex-wrap justify-content-center" id="plazas-container">
                            <!-- Las plazas se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12 text-center">
                <button class="btn btn-primary" onclick="window.location.href='/admin.html'">Panel de Administración</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // Crear plazas
        const plazasContainer = document.getElementById('plazas-container');
        for (let i = 0; i < 6; i++) {
            const plaza = document.createElement('div');
            plaza.className = 'plaza libre';
            plaza.id = `plaza-${i + 1}`;
            plaza.textContent = i + 1;
            plazasContainer.appendChild(plaza);
        }

        // Actualizar estado
        socket.on('status', (state) => {
            // Actualizar LCD
            document.getElementById('lcd-line1').textContent = state.lcd.line1;
            document.getElementById('lcd-line2').textContent = state.lcd.line2;

            // Actualizar plazas
            state.plazas.forEach((libre, i) => {
                const plaza = document.getElementById(`plaza-${i + 1}`);
                plaza.className = `plaza ${libre ? 'libre' : 'ocupada'}`;
            });

            // Actualizar barreras
            const barreraEntrada = document.getElementById('barrera-entrada');
            barreraEntrada.className = `btn barrera ${state.barreras.entrada ? 'abierta' : 'cerrada'}`;
            barreraEntrada.textContent = state.barreras.entrada ? 'Abierta' : 'Cerrada';

            const barreraSalida = document.getElementById('barrera-salida');
            barreraSalida.className = `btn barrera ${state.barreras.salida ? 'abierta' : 'cerrada'}`;
            barreraSalida.textContent = state.barreras.salida ? 'Abierta' : 'Cerrada';
        });
    </script>
</body>
</html>